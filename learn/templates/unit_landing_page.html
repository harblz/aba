{% extends 'base.html' %}

{% block content %}{% block mobile-content %}
    <div id="post_container" class="post container" style="padding: 0 2.5% 5% 2.5%; visibility: hidden;margin-top: 25px;">
      <div class="row">

        <div class="calendar-icon col-1">
        </div>

        <div class="col-2"> </div>

        <div class="col-10">

          <h2><strong>
           {{ learn_topic.title }}
          </strong></h2>
          <h4 class="text-muted">Test {{ learn_topic.lesson_unit }}</h4>
          <br />

          {{ learn_topic.body | safe }}


          <br />
          <br />


          <hr>
          <h3>
            Let's Practice:
          </h3>

          <br />
          <br />

          <strong>
            Lesson Progress
          </strong>
          <div class="progress">
            <div id="progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <i class="text-muted">Complete the unit quizzes below to progress forward in this unit, or click here to <a href="#" onClick="markComplete()"><b>mark this unit as complete</b></i></a>


          <br />
          <br />

          {% if learn_topic.lesson_quizzes %}
            <ul id="completed_quizzes">
            {% for quiz in learn_topic.lesson_quizzes.all %}
              <li><a id="quiz_{{quiz.id}}" href="/quiz/{{quiz.form_unit.id}}/form_{{quiz.id}}/">{{quiz.form_name}}</a></li>
            {% endfor %}
            </ul>
          {% endif %}

          <br />
          <br />
          <br />

          <div class="container" style="text-align: center;">      
            <h3>
              Next Up:
            </h3>

            <br />

            {% if learn_topic.last_lesson %}
              <a class="btn btn-primary" href="{{ learn_topic.last_lesson.id }}">
                <i class="fas fa-step-backward"></i>
                 Last Unit: 
                <strong>
                  {{ learn_topic.last_lesson }}
                </strong>
              </a>
            {% endif %}

            {% if learn_topic.next_lesson %}
              <a class="btn btn-primary" href="{{ learn_topic.next_lesson.id }}">
                Next Unit: 
                <strong>
                  {{ learn_topic.next_lesson }}
                  <i class="fas fa-step-forward"></i>
                </strong>
              </a>
            {% endif %}
          </div>

          <hr> 
          <br />
          <br />
          <br />
          <br />

        </div>

      </div>

      <div id="disqus_thread" class="post-text col-12"></div>

    </div>


      <script>
        function checkProgress() {
          //var progress = "{{ user.profile.user_quiz_forms_completed.all }}";
          var completed_quiz_ids = [];
          {% if user.profile.user_quiz_forms_completed.all %}
            {% for quiz in user.profile.user_quiz_forms_completed.all %}
              completed_quiz_ids["{{forloop.counter0}}"] = "{{quiz.id}}";
            {% endfor %}
          {% endif %}

          var lesson_quizzes = [];
           {% if learn_topic.lesson_quizzes %}
            {% for quiz in learn_topic.lesson_quizzes.all %}
              lesson_quizzes["{{forloop.counter0}}"] = "{{quiz.id}}"
            {% endfor %}
          {% endif %}

          console.log('completed_quiz_ids', completed_quiz_ids, 'lesson_quizzes', lesson_quizzes);
          count_completed_lesson_quizzes = 0;
          for (i = 0; i < completed_quiz_ids.length; i++) {
            var found = lesson_quizzes.indexOf(completed_quiz_ids[i]);
            if (found != null) {
              console.log(found);
              count_completed_lesson_quizzes++;
              text = document.getElementById('quiz_'+completed_quiz_ids[i]).innerHTML;
              document.getElementById('quiz_'+completed_quiz_ids[i]).innerHTML = '<i class="fas fa-check-circle"></i> &nbsp&nbsp' + text;
              document.getElementById('quiz_'+completed_quiz_ids[i]).classList += 'text-muted'
            }
          }
          var progress = (100*count_completed_lesson_quizzes/lesson_quizzes.length)+'%';
          console.log('progress: ', progress);
          recordProgress(progress);
        }
        checkProgress();


        function markComplete() {
          recordProgress("100%");
          alert('{{learn_topic.lesson_unit}} - marked complete!')
        }


        function recordProgress(progress) {
          document.getElementById('progress-bar').style.width = progress;
        }


        function resize() {
          // Resize post container for desktop
          if (window.screen.width <= 576) {
            document.querySelector("#post_container").style.visibility = "visible";
          } else if ( window.screen.width >= 576 && window.screen.width <= 900) {
            document.querySelector("#post_container").style.marginLeft = window.screen.width * 0.20 + "px";
            document.querySelector("#post_container").style.visibility = "visible";
          } else if ( window.screen.width >= 900 && window.screen.width <= 1200) {
            document.querySelector("#post_container").style.marginLeft = window.screen.width * 0.265 + "px";
            document.querySelector("#post_container").style.visibility = "visible";
          }    else {
            document.querySelector("#post_container").style.visibility = "visible";
          }
        }

        window.onload = function () { 
          resize();
        }

        window.onresize = function(event) {
            resize();
        };
      </script>
      {% include "disqus.html" %}
                            

      </div>
    </div>
{% endblock %}{% endblock %}

